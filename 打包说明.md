# 打包说明

## 快速开始

### 方法一：使用自动打包脚本（推荐）

1. 双击运行 `build.bat`
2. 等待打包完成（约2-5分钟）
3. 在 `dist` 文件夹中找到生成的 `.exe` 文件

### 方法二：手动打包

在项目目录下打开PowerShell或CMD，运行：

```powershell
# 单文件版本（推荐分发）
pyinstaller --name="明日方舟终末地抽卡模拟器" --onefile --windowed ui_main.py

# 文件夹版本（启动更快）
pyinstaller --name="明日方舟终末地抽卡模拟器" --windowed ui_main.py
```

## 打包选项说明

### 基础参数

- `--name` : 设置生成的可执行文件名称
- `--onefile` : 打包成单个exe文件（方便分发，但启动稍慢）
- `--windowed` 或 `-w` : GUI程序，不显示控制台窗口
- `--icon=icon.ico` : 设置程序图标（需要先准备.ico文件）

### 高级参数

- `--clean` : 打包前清理临时文件
- `--noconfirm` : 覆盖已有文件时不询问
- `--add-data "src;dest"` : 添加数据文件（Windows用分号，Linux/Mac用冒号）
- `--hidden-import=module` : 手动指定需要打包的隐藏模块
- `--exclude-module=module` : 排除不需要的模块以减小体积

## 生成的文件

### 使用 `--onefile` 模式：
```
dist/
└── 明日方舟终末地抽卡模拟器.exe  (单个可执行文件，约40-80MB)
```

### 不使用 `--onefile` 模式：
```
dist/
└── 明日方舟终末地抽卡模拟器/
    ├── 明日方舟终末地抽卡模拟器.exe
    ├── python313.dll
    ├── 各种依赖库.dll
    └── 其他资源文件
```

## 测试建议

1. 在打包完成后，先在本机测试exe是否能正常运行
2. 在另一台**没有安装Python**的电脑上测试
3. 检查以下功能：
   - 程序能否正常启动
   - 界面显示是否正常（特别是中文）
   - 能否运行模拟
   - 能否生成PNG图片

## 常见问题

### 1. 打包后文件很大（50MB+）

**正常现象**。因为打包了整个Python运行环境和所有依赖库。

**减小体积的方法**：
- 使用虚拟环境，只安装必要的包
- 使用 `--exclude-module` 排除不需要的大型库
- 考虑使用UPX压缩（可能导致杀毒软件误报）

### 2. 杀毒软件报毒

**正常现象**。PyInstaller打包的程序可能被误报。

**解决方法**：
- 添加信任/白名单
- 使用代码签名证书
- 在打包前进行病毒扫描

### 3. 打包失败或缺少模块

**检查依赖**：
```powershell
pip list
```

**手动指定隐藏导入**：
```powershell
pyinstaller --hidden-import=matplotlib.backends.backend_agg --hidden-import=scipy ui_main.py
```

### 4. 中文显示乱码

程序中已使用 `matplotlib.use('Agg')` 设置非交互式后端，并配置了中文字体。如果仍有问题：

- 确保系统安装了黑体或微软雅黑字体
- 可以在spec文件中添加字体文件

### 5. 程序启动慢

使用 `--onefile` 模式会在临时目录解压，导致首次启动慢。

**解决方法**：
- 使用文件夹模式（不加 `--onefile`）
- 或者接受这个小延迟

## 分发建议

### 单文件版本（--onefile）
直接分发 `.exe` 文件即可，用户下载后双击运行。

### 文件夹版本
将整个文件夹打包成 `.zip` 或 `.7z` 分发，告知用户：
1. 解压到任意目录
2. 运行主exe文件

### 附加说明
建议附带一个使用说明文档，包括：
- 程序功能介绍
- 输入参数说明
- 输出结果解读
- 常见问题

## 进阶：使用spec文件

生成spec文件：
```powershell
pyi-makespec --onefile --windowed ui_main.py
```

编辑 `.spec` 文件可以进行更精细的控制，然后使用：
```powershell
pyinstaller 明日方舟终末地抽卡模拟器.spec
```

## 自动更新

如果需要版本更新功能，可以考虑：
1. 在程序中添加版本检查
2. 使用GitHub Releases发布新版本
3. 程序检测到新版本时提示用户下载
